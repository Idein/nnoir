# onnx2onnx

This package purpose is to allow the use of NN models generated by AutoML services ([Google Cloud Vision](https://cloud.google.com/vision/overview/docs#automl-vision),
[Azure custom Vision](https://azure.microsoft.com/en-us/services/cognitive-services/custom-vision-service/)),
to an [Actcast](https://actcast.io/) application.

The format for NN models in Actcast is [nnoir](https://github.com/Idein/nnoir), and the tool [nnoir-onnx](https://pypi.org/project/nnoir-onnx/) allows conversion from [ONNX](https://github.com/onnx/onnx) format to nnoir.

Some ONNX operators used in AutoML-generated models may not be supported by nnoir-onnx, and using this package allows the conversion by modifying an onnx model by replacing unsupported nodes to equivalent supported ones.

See #Examples section for use samples.

## Requirements

- Python >= 3.5
  - onnx
  - nnoir-onnx

## Installation

```bash
pip3 install .
```

## Usage

In a python script:

```python
import onnx
from onnx2onnxlib import fix

model = onnx.load("path/to/mymodel.onnx")  # open onnx model

fix.fix_quantize(model)  # apply fixes in-place
fix.fix_name(model)
.
.
.

onnx.save(model, "mymodel_fixed.onnx")  # save fixed model
```

or using commd line:

```bash
user~$ onnx2onnx -o mymodel_fixed.onnx path/to/mymodel.onnx --fixes fix_quantize fix_name
```

Omitting `fixes` argument applies all fixes (in alphabetical order).
For models created with Google Cloud Vision, the recommanded fixes are

```bash
... --fixes fix_quantize fix_name
```

And for Azure custom vision models:

```bash
... --fixes fix_postprocess fix_split fix_name fix_freeze
```

## Example

Follow the instructions in `examples/tutorial.md` for details.
